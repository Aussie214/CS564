SELECT sup_nat.N_NAME,

/* Column for sales from within a sup region */
(SELECT SUM(LINEITEM.L_QUANTITY * (LINEITEM.L_EXTENDEDPRICE - LINEITEM.L_DISCOUNT)) AS Regional_Orders
FROM LINEITEM, ORDERS, NATION AS c_nat, CUSTOMER, SUPPLIER
WHERE
LINEITEM.L_SUPPKEY = SUPPLIER.S_SUPPKEY
AND
SUPPLIER.S_NATIONKEY = sup_nat.N_NATIONKEY
AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
AND
ORDERS.O_CUSTKEY = CUSTOMER.C_CUSTKEY
AND
CUSTOMER.C_NATIONKEY = c_nat.N_NATIONKEY
AND
sup_nat.N_REGIONKEY = c_nat.N_REGIONKEY
) AS Reg, 

/* Column for Sales from outside a sup region */
(SELECT SUM(LINEITEM.L_QUANTITY * (LINEITEM.L_EXTENDEDPRICE - LINEITEM.L_DISCOUNT)) AS Non_Regional_Orders
FROM LINEITEM, ORDERS, NATION AS c_nat, CUSTOMER, SUPPLIER
WHERE
LINEITEM.L_SUPPKEY = SUPPLIER.S_SUPPKEY
AND
SUPPLIER.S_NATIONKEY = sup_nat.N_NATIONKEY
AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
AND
ORDERS.O_CUSTKEY = CUSTOMER.C_CUSTKEY
AND
CUSTOMER.C_NATIONKEY = c_nat.N_NATIONKEY
AND
sup_nat.N_REGIONKEY <> c_nat.N_REGIONKEY
) AS Non_Reg

FROM NATION as sup_nat

GROUP BY sup_nat.N_NAME
ORDER BY Reg DESC;

/* 9074262305
